<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example Programs &mdash; AtomVM 0.5.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Network Programming Guide" href="network-programming-guide.html" />
    <link rel="prev" title="Programmers Guide" href="programmers-guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> AtomVM
          </a>
              <div class="version">
                0.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="welcome-to-atomvm.html">Welcome to AtomVM!</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started-guide.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="programmers-guide.html">Programmers Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example Programs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#erlang-examples">Erlang Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hello-world"><code class="docutils literal notranslate"><span class="pre">hello_world</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#command-line">Command line</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#udp-server"><code class="docutils literal notranslate"><span class="pre">udp_server</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Command line</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#udp-client"><code class="docutils literal notranslate"><span class="pre">udp_client</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Command line</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tcp-server"><code class="docutils literal notranslate"><span class="pre">tcp_server</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Command line</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tcp-client"><code class="docutils literal notranslate"><span class="pre">tcp_client</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Command line</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#esp32-examples">ESP32 Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flashing-atomvm-examples-for-esp32">Flashing AtomVM Examples for ESP32</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#blink"><code class="docutils literal notranslate"><span class="pre">blink</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#esp-random"><code class="docutils literal notranslate"><span class="pre">esp_random</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#esp-nvs"><code class="docutils literal notranslate"><span class="pre">esp_nvs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#reformat-nvs"><code class="docutils literal notranslate"><span class="pre">reformat_nvs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-network-config"><code class="docutils literal notranslate"><span class="pre">set_network_config</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#sta-network"><code class="docutils literal notranslate"><span class="pre">sta_network</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#udp-server-blink"><code class="docutils literal notranslate"><span class="pre">udp_server_blink</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcp-server-blink"><code class="docutils literal notranslate"><span class="pre">tcp_server_blink</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="network-programming-guide.html">Network Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-instructions.html">Build Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="atomvm-internals.html">AtomVM Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory-management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="packbeam-format.html">Packbeam Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference-documentation.html">API Reference Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AtomVM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Example Programs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/example-programs.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <!--
 Copyright 2019 Fred Dushin <fred@dushin.net>
 SPDX-License-Identifier: Apache-2.0 OR LGPL-2.1-or-later
-->
<section class="tex2jax_ignore mathjax_ignore" id="example-programs">
<h1>Example Programs<a class="headerlink" href="#example-programs" title="Permalink to this headline"></a></h1>
<p>AtomVM includes a collection of useful examples for getting started.  This section describes what these examples do, and how to run them, for example, on an ESP32 device.</p>
<section id="erlang-examples">
<h2>Erlang Examples<a class="headerlink" href="#erlang-examples" title="Permalink to this headline"></a></h2>
<p>Erlang examples may be run in the UNIX shell or on supported microcontroller devices.</p>
<section id="hello-world">
<h3><code class="docutils literal notranslate"><span class="pre">hello_world</span></code><a class="headerlink" href="#hello-world" title="Permalink to this headline"></a></h3>
<p>This example program prints the string “Hello World” and quits.</p>
<section id="command-line">
<h4>Command line<a class="headerlink" href="#command-line" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">hello_world.avm</span></code> file will get created as part of a build.  This file may be supplied as an argument to the <code class="docutils literal notranslate"><span class="pre">AtomVM</span></code> command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./src/AtomVM ./examples/erlang/hello_world.avm
Hello World
Return value: ok
</pre></div>
</div>
</section>
</section>
<section id="udp-server">
<h3><code class="docutils literal notranslate"><span class="pre">udp_server</span></code><a class="headerlink" href="#udp-server" title="Permalink to this headline"></a></h3>
<p>This example program listens on UDP port 44444 and will print information about the received message, including the source IP, (ephemeral) source port, and packet received, to the console.</p>
<section id="id1">
<h4>Command line<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">udp_server.avm</span></code> file will get created as part of a build.  This file may be supplied as an argument to the <code class="docutils literal notranslate"><span class="pre">AtomVM</span></code> command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./src/AtomVM ./examples/erlang/udp_server.avm
Opened UDP socket on &quot;0.0.0.0:44404&quot;.
Waiting to receive data...
</pre></div>
</div>
<p>You can send UDP packets to the AtomVM instance using <code class="docutils literal notranslate"><span class="pre">netcat</span></code> (or <code class="docutils literal notranslate"><span class="pre">nc</span></code> on some platforms), in a separate terminal window:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ nc -u localhost 44404
</pre></div>
</div>
<p>This command will wait for you to enter a line of text, e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testing 1 2 3
</pre></div>
</div>
<p>In the AtomVM termianl window, you see:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Received UDP packet &lt;&lt;116,101,115,116,105,110,103,32,49,32,50,32,51,10&gt;&gt; from &quot;127.0.0.1:55261&quot;
Waiting to receive data...
</pre></div>
</div>
<blockquote>
<div><p>Note.  Netcat appends a newline character at the end of the input, so the packet binary does not display as printable text.</p>
</div></blockquote>
</section>
</section>
<section id="udp-client">
<h3><code class="docutils literal notranslate"><span class="pre">udp_client</span></code><a class="headerlink" href="#udp-client" title="Permalink to this headline"></a></h3>
<p>This example program send the packet of data (“:アトムＶＭ”) over UDP to port 44444 on the loopback address every 5 seconds, in a loop.  The program will print a period (<code class="docutils literal notranslate"><span class="pre">.</span></code>) to the console, every time it sends a message.</p>
<p>This command may be used in tandem with the <code class="docutils literal notranslate"><span class="pre">udp_server</span></code> program to illustrate sending messages between AtomVM processes over UDP.</p>
<section id="id2">
<h4>Command line<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">udp_client.avm</span></code> file will get created as part of a build.  This file may be supplied as an argument to the <code class="docutils literal notranslate"><span class="pre">AtomVM</span></code> command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./src/AtomVM ./examples/erlang/udp_client.avm
Opened UDP socket on &quot;0.0.0.0:63665&quot;.
Sent &lt;&lt;58,-94,-56,-32,54,45&gt;&gt;
Sent &lt;&lt;58,-94,-56,-32,54,45&gt;&gt;
Sent &lt;&lt;58,-94,-56,-32,54,45&gt;&gt;
...
</pre></div>
</div>
<p>If you are running the <code class="docutils literal notranslate"><span class="pre">udp_server</span></code> program, you should see messages like the following printed to the console:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Received UDP packet &lt;&lt;58,-94,-56,-32,54,45&gt;&gt; from &quot;127.0.0.1:63665&quot;
Waiting to receive data...
Received UDP packet &lt;&lt;58,-94,-56,-32,54,45&gt;&gt; from &quot;127.0.0.1:63665&quot;
Waiting to receive data...
Received UDP packet &lt;&lt;58,-94,-56,-32,54,45&gt;&gt; from &quot;127.0.0.1:63665&quot;
Waiting to receive data...
...
</pre></div>
</div>
<blockquote>
<div><p>Note. AtomVM does not currently treat characters outside of the printable ASCII character set as printable characters.</p>
</div></blockquote>
</section>
</section>
<section id="tcp-server">
<h3><code class="docutils literal notranslate"><span class="pre">tcp_server</span></code><a class="headerlink" href="#tcp-server" title="Permalink to this headline"></a></h3>
<p>This example program listens on TCP port 44404 and accept connections on that port.  Once accepted, it will wait for packets to be sent from the client.  Once received, the server will print the packet received to the console, and then echo the packet back to the calling client.</p>
<section id="id3">
<h4>Command line<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">tcp_server.avm</span></code> file will get created as part of a build.  This file may be supplied as an argument to the <code class="docutils literal notranslate"><span class="pre">AtomVM</span></code> command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./src/AtomVM ./examples/erlang/tcp_server.avm
Listening on &quot;0.0.0.0:44404&quot;.
Waiting to accept connection...
</pre></div>
</div>
<p>You can send TCP packets to the AtomVM instance using <code class="docutils literal notranslate"><span class="pre">netcat</span></code> (or <code class="docutils literal notranslate"><span class="pre">nc</span></code> on some platforms), in a separate terminal window:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ nc localhost 44404
</pre></div>
</div>
<p>This will open a TCP connection to the <code class="docutils literal notranslate"><span class="pre">tcp_server</span></code>, and you should see the following on the console:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Accepted connection.  local: &quot;127.0.0.1:44404&quot; peer: &quot;127.0.0.1:56628&quot;
Waiting to receive data...
Waiting to accept connection...
</pre></div>
</div>
<p>The netcat command will wait for you to enter a line of text, e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>testing 1 2 3
</pre></div>
</div>
<p>In the AtomVM terminal window, you see:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Received packet [116,101,115,116,105,110,103,32,49,32,50,32,51,10] from &quot;127.0.0.1:56628&quot;.  Echoing back...
Waiting to receive data...
</pre></div>
</div>
<blockquote>
<div><p>Note.  Netcat appends a newline character at the end of the input, so the packet binary does not display as printable text.</p>
</div></blockquote>
<p>You may enter as much data as you like, though by default, the packet size will be limited to 128 bytes.</p>
<p>If you stop the <code class="docutils literal notranslate"><span class="pre">netcat</span></code> command (via ^C), you should</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Connection closed.
</pre></div>
</div>
<p>printed to the AtomVM console.</p>
<p>Note that you can have multiple, concurrent TCP/IP connections to your AtomVM server.</p>
</section>
</section>
<section id="tcp-client">
<h3><code class="docutils literal notranslate"><span class="pre">tcp_client</span></code><a class="headerlink" href="#tcp-client" title="Permalink to this headline"></a></h3>
<p>This example program send the packet of data (“:アトムＶＭ”) over TCP to port 44404 on the loopback address every 1 second, in a loop.  The program will wait for a response from the server, before proceeding.</p>
<p>This command may be used in tandem with the <code class="docutils literal notranslate"><span class="pre">tcp_server</span></code> program to illustrate sending messages between AtomVM processes over TCP.</p>
<blockquote>
<div><p>Note.  You will need to change the <code class="docutils literal notranslate"><span class="pre">Address</span></code> variable in the <code class="docutils literal notranslate"><span class="pre">tcp_client.erl</span></code> program in order to test against an AtomVM server running on a different host or device.</p>
</div></blockquote>
<section id="id4">
<h4>Command line<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">tcp_client.avm</span></code> file will get created as part of a build.  This file may be supplied as an argument to the <code class="docutils literal notranslate"><span class="pre">AtomVM</span></code> command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./src/AtomVM ./examples/erlang/tcp_client.avm
Connected to &quot;127.0.0.1:44404&quot; from &quot;127.0.0.1:56741&quot;
Sent &lt;&lt;58,-94,-56,-32,54,45&gt;&gt; to &quot;127.0.0.1:44404&quot;
Received [58,162,200,224,54,45] from &quot;127.0.0.1:44404&quot;
Sent &lt;&lt;58,-94,-56,-32,54,45&gt;&gt; to &quot;127.0.0.1:44404&quot;
Received [58,162,200,224,54,45] from &quot;127.0.0.1:44404&quot;
Sent &lt;&lt;58,-94,-56,-32,54,45&gt;&gt; to &quot;127.0.0.1:44404&quot;
Received [58,162,200,224,54,45] from &quot;127.0.0.1:44404&quot;
...
</pre></div>
</div>
<p>If you are running the <code class="docutils literal notranslate"><span class="pre">tcp</span> <span class="pre">_server</span></code> program, you should see messages like the following printed to the console:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Accepted connection.  local: &quot;127.0.0.1:44404&quot; peer: &quot;127.0.0.1:56741&quot;
Waiting to receive data...
Waiting to accept connection...
Received packet [58,162,200,224,54,45] from &quot;127.0.0.1:56741&quot;.  Echoing back...
Waiting to receive data...
Received packet [58,162,200,224,54,45] from &quot;127.0.0.1:56741&quot;.  Echoing back...
Waiting to receive data...
Received packet [58,162,200,224,54,45] from &quot;127.0.0.1:56741&quot;.  Echoing back...
Waiting to receive data...
...
</pre></div>
</div>
<blockquote>
<div><p>Note. AtomVM does not currently treat characters outside of the printable ASCII character set as printable characters.</p>
</div></blockquote>
<p>You may run multiple concurrent instances of the <code class="docutils literal notranslate"><span class="pre">tcp_client</span></code> against a single <code class="docutils literal notranslate"><span class="pre">tcp_server</span></code> instance.</p>
</section>
</section>
</section>
<section id="esp32-examples">
<h2>ESP32 Examples<a class="headerlink" href="#esp32-examples" title="Permalink to this headline"></a></h2>
<p>AtomVM includes examples that are specifically designed for the ESP32 and other microcontrollers.</p>
</section>
<section id="flashing-atomvm-examples-for-esp32">
<h2>Flashing AtomVM Examples for ESP32<a class="headerlink" href="#flashing-atomvm-examples-for-esp32" title="Permalink to this headline"></a></h2>
<p>In order to run the ESP32 examples, you will need to flash the example AVM files that are created as part of the build to your device.</p>
<p>In the remainder of this document, we assume the <code class="docutils literal notranslate"><span class="pre">flash.sh</span></code> script, located in the <code class="docutils literal notranslate"><span class="pre">tools/dev</span></code> directory of the AtomVM source tree.</p>
<blockquote>
<div><p>Note. You must set the <code class="docutils literal notranslate"><span class="pre">ESP_IDF</span></code> environment variable to the root directory of the ESP IDF SDK installation on your development machine.</p>
</div></blockquote>
<p>You can control the serial port and baud rate via the <code class="docutils literal notranslate"><span class="pre">FLASH_SERIAL_PORT</span></code> and <code class="docutils literal notranslate"><span class="pre">FLASH_BAUD_RATE</span></code> environment variables, e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ export FLASH_SERIAL_PORT=&quot;/dev/tty.SLAB_USBtoUART&quot;
shell$ export FLASH_BAUD_RATE=921600
</pre></div>
</div>
<p>The default values for these variables, if not set, are <code class="docutils literal notranslate"><span class="pre">/dev/ttyUSB0</span></code> and <code class="docutils literal notranslate"><span class="pre">115200</span></code>, respectively.</p>
<blockquote>
<div><p>Note. Experiment with baud rates (e.g., 921600).  You may find you can shorten the flash-debug-flash cycle with higher rates.</p>
</div></blockquote>
<p>You can montor the console output of these examples by issuing the <code class="docutils literal notranslate"><span class="pre">monitor</span></code> target to <code class="docutils literal notranslate"><span class="pre">make</span></code>, in the <code class="docutils literal notranslate"><span class="pre">src/platforms/esp32</span></code> directory of the AtomVM source tree:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
MONITOR
--- WARNING: Serial ports accessed as /dev/tty.* will hang gdb if launched.
--- Using /dev/cu.SLAB_USBtoUART instead...
--- idf_monitor on /dev/cu.SLAB_USBtoUART 115200 ---
--- Quit: Ctrl+] | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
ets Jun  8 2016 00:22:57
...
</pre></div>
</div>
<section id="blink">
<h3><code class="docutils literal notranslate"><span class="pre">blink</span></code><a class="headerlink" href="#blink" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">blink</span></code> example will turn the blue LED on an ESP32 SoC (pin 2) on and off, once every second.</p>
<p>Flash the example program to your device as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/blink.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see the blue LED turn on and off on your ESP32 device.</p>
</section>
<section id="esp-random">
<h3><code class="docutils literal notranslate"><span class="pre">esp_random</span></code><a class="headerlink" href="#esp-random" title="Permalink to this headline"></a></h3>
<p>This demo program illustrates use of the ESP32 <code class="docutils literal notranslate"><span class="pre">random</span></code>, <code class="docutils literal notranslate"><span class="pre">restart</span></code>, and <code class="docutils literal notranslate"><span class="pre">reset_reason</span></code> functions.</p>
<p>The program will generate a random binary of a random size (at most 127 bytes) every 5 seconds.  If a 0-length byte sequence is generated (1:128 probability), the ESP will restart.</p>
<p>Flash the example program to your device as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/esp_random.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see something like the following output when monitoring the ESP32 output (truncated for brevity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
...
Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: esp_random.beam...
---
Reset reason: esp_rst_poweron
Random bytes: &lt;&lt;71,13,221,24,8,15,...,197,120,152,205&gt;&gt;
Random bytes: &lt;&lt;37,155,124,177,44,141,40,106,...,43,48,62,109,2,78,39,107&gt;&gt;
Random bytes: &lt;&lt;217,210,239,183,...,78,68,253,146,212,71,17,208,219,126,240,218,34,0,152,80,20,166,194,106&gt;&gt;
Random bytes: &lt;&lt;112,77,123,249,162,...,238,237,128,227,58,29,64,74&gt;&gt;
...
&lt;&lt;&quot;&quot;&gt;&gt;
ets Jun  8 2016 00:22:57
...
Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: esp_random.beam...
---
esp_rst_sw
Random bytes: &lt;&lt;155,174,204,143,232,202,136,...,118,177,77,230,10,21,72,91,92,160,198,115,249,217,206,52,102,32,230&gt;&gt;
...
</pre></div>
</div>
</section>
<section id="esp-nvs">
<h3><code class="docutils literal notranslate"><span class="pre">esp_nvs</span></code><a class="headerlink" href="#esp-nvs" title="Permalink to this headline"></a></h3>
<p>This demo program illustrates the use of ESP32 non-volatile storage (NVS).</p>
<p>The program will store the number of times the device has been rebooted, along with the start time, in NVS.</p>
<p>Flash the example program to your device as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/esp_nvs.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see the following output when monitoring the ESP32 output (truncated for brevity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
...
Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: esp_nvs.beam...
---
Saving count 0 to NVS...
Reset device to increment.
AtomVM finished with return value = ok
going to sleep forever..
</pre></div>
</div>
<p>Hit the reset button on your device, and the ESP device will reboot, and display something like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: esp_nvs.beam...
---
Saving count 1 to NVS...
Reset device to increment.
AtomVM finished with return value = ok
going to sleep forever..
</pre></div>
</div>
</section>
<section id="reformat-nvs">
<h3><code class="docutils literal notranslate"><span class="pre">reformat_nvs</span></code><a class="headerlink" href="#reformat-nvs" title="Permalink to this headline"></a></h3>
<p>This demo program will reformat the non-volatile storage (NVS) partition.</p>
<p>Flash the example program to your device as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/reformat_nvs.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see the following output when monitoring the ESP32 output (truncated for brevity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
...
Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: esp_nvs.beam...
---
Warning: Reformatted NVS partition!
AtomVM finished with return value = ok
going to sleep forever..
</pre></div>
</div>
<p>The NVS partition on your ESP device should be reformatted.</p>
<blockquote>
<div><p>Note.  This program will irrevocably delete all existing key-values stored on the NVS partition.  Use with caution.</p>
</div></blockquote>
</section>
<section id="set-network-config">
<h3><code class="docutils literal notranslate"><span class="pre">set_network_config</span></code><a class="headerlink" href="#set-network-config" title="Permalink to this headline"></a></h3>
<p>This demo program can be used to set the WIFI credentials in NVS.  Setting WIFI credentials in NVS can greatly simplify the task of running ESP programs that require connectivity to WIFI networks.</p>
<blockquote>
<div><p>Note.  Credentials are stored unencrypted and in plaintext and should not be considered secure.  Future versions may use encrypted NVS storage.</p>
</div></blockquote>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">sta_network_config.erl</span></code> program and set the <code class="docutils literal notranslate"><span class="pre">Ssid</span></code> binary with your WIFI AP SSID, and <code class="docutils literal notranslate"><span class="pre">Psk</span></code> binary with the password used to access your WIFI network.  Save the file, rebuild, and flash to your device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make
...
shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/sta_network_config.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see the following output when monitoring the ESP32 output (truncated for brevity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
...
Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: set_network_config.beam...
---
{atomvm,sta_ssid,&lt;&lt;&quot;myssid&quot;&gt;&gt;}
{atomvm,sta_psk,&lt;&lt;&quot;xxxxxx&quot;&gt;&gt;}
AtomVM finished with return value = ok
going to sleep forever..
</pre></div>
</div>
<p>You may now run programs that use your WIFI network (see below) without needing to enter WIFI credentials.</p>
</section>
<section id="sta-network">
<h3><code class="docutils literal notranslate"><span class="pre">sta_network</span></code><a class="headerlink" href="#sta-network" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sta_network</span></code> example will connect to your local WiFi network and obtain and IP address.  Once a connection is established, a <code class="docutils literal notranslate"><span class="pre">connected</span></code> message will be displayed.  Once an IP address is obtained, the device IP address, netmask, and gateway will be displayed on the console.</p>
<blockquote>
<div><p>Note.  AtomVM currently only supports station mode (STA).</p>
</div></blockquote>
<blockquote>
<div><p>Note.  AtomVM currently only supports IPv4 addresses.</p>
</div></blockquote>
<blockquote>
<div><p>Note.  If you have not set WIFI credentials in NVS (see above), you will need to edit the <code class="docutils literal notranslate"><span class="pre">examples/erlang/esp32/sta_network.erl</span></code> source file and set the <code class="docutils literal notranslate"><span class="pre">ssid</span></code> and <code class="docutils literal notranslate"><span class="pre">psk</span></code> parameters to match your local WiFi network, and then rebuild the example.</p>
</div></blockquote>
<p>Flash the example program to your device as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/sta_network.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see the following output when monitoring the ESP32 output (truncated for brevity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
...
Starting: sta_network.beam...
---
I (220) wifi: wifi driver task: 3ffc3b54, prio:23, stack:3584, core=0
I (220) wifi: wifi firmware version: d5da5a5
I (220) wifi: config NVS flash: enabled
I (220) wifi: config nano formatting: disabled
I (230) system_api: Base MAC address is not set, read default base MAC address from BLK0 of EFUSE
I (240) system_api: Base MAC address is not set, read default base MAC address from BLK0 of EFUSE
I (270) wifi: Init dynamic tx buffer num: 32
I (270) wifi: Init data frame dynamic rx buffer num: 32
I (270) wifi: Init management frame dynamic rx buffer num: 32
I (270) wifi: Init static rx buffer size: 1600
I (280) wifi: Init static rx buffer num: 10
I (280) wifi: Init dynamic rx buffer num: 32
I (290) NETWORK: starting wifi: SSID: [myssid], password: [XXXXXXXX].
I (360) phy: phy_version: 4000, b6198fa, Sep  3 2018, 15:11:06, 0, 0
I (370) wifi: mode : sta (3c:71:bf:84:d9:08)
I (370) NETWORK: SYSTEM_EVENT_STA_START received.
I (490) wifi: n:1 0, o:1 0, ap:255 255, sta:1 0, prof:1
I (1470) wifi: state: init -&gt; auth (b0)
I (1480) wifi: state: auth -&gt; assoc (0)
I (1490) wifi: state: assoc -&gt; run (10)
I (1500) wifi: connected with myssid, channel 1
I (1500) wifi: pm start, type: 1
I (1500) NETWORK: SYSTEM_EVENT_STA_CONNECTED received.
I (3690) event: sta ip: 192.168.1.236, mask: 255.255.255.0, gw: 192.168.1.1
I (3690) NETWORK: SYSTEM_EVENT_STA_GOT_IP: 192.168.1.236
connected
{{192,168,1,236},{255,255,255,0},{192,168,1,1}}
</pre></div>
</div>
</section>
<section id="udp-server-blink">
<h3><code class="docutils literal notranslate"><span class="pre">udp_server_blink</span></code><a class="headerlink" href="#udp-server-blink" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">udp_server_blink</span></code> example will connect to your local WiFi network and obtain and IP address.  It will then start a UDP server on port 44444.  When a UDP message is received, the blue LED on the ESP32 SoC (pin 2) will toggle on and off.</p>
<blockquote>
<div><p>Note.  AtomVM currently only supports station mode (STA).</p>
</div></blockquote>
<blockquote>
<div><p>Note.  AtomVM currently only supports IPv4 addresses.</p>
</div></blockquote>
<blockquote>
<div><p>Note.  You will need to edit the <code class="docutils literal notranslate"><span class="pre">examples/erlang/esp32/udp_server_blink.erl</span></code> source file and set the <code class="docutils literal notranslate"><span class="pre">ssid</span></code> and <code class="docutils literal notranslate"><span class="pre">psk</span></code> parameters to match your local WiFi network, and then rebuild the example.</p>
</div></blockquote>
<p>Flash the example program to your device as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/udp_server_blink.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see the following output when monitoring the ESP32 output (truncated for brevity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
...
Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: udp_server_blink.beam...
---
I (222) wifi: wifi driver task: 3ffc3de8, prio:23, stack:3584, core=0
I (222) wifi: wifi firmware version: d5da5a5
I (222) wifi: config NVS flash: enabled
I (232) wifi: config nano formatting: disabled
I (232) system_api: Base MAC address is not set, read default base MAC address from BLK0 of EFUSE
I (242) system_api: Base MAC address is not set, read default base MAC address from BLK0 of EFUSE
I (312) wifi: Init dynamic tx buffer num: 32
I (312) wifi: Init data frame dynamic rx buffer num: 32
I (312) wifi: Init management frame dynamic rx buffer num: 32
I (312) wifi: Init static rx buffer size: 1600
I (322) wifi: Init static rx buffer num: 10
I (322) wifi: Init dynamic rx buffer num: 32
I (332) NETWORK: starting wifi: SSID: [myssid], password: [XXXXXXXX].
I (442) phy: phy_version: 4000, b6198fa, Sep  3 2018, 15:11:06, 0, 0
I (442) wifi: mode : sta (3c:71:bf:84:d9:08)
I (442) NETWORK: SYSTEM_EVENT_STA_START received.
I (572) wifi: n:1 0, o:1 0, ap:255 255, sta:1 0, prof:1
I (1552) wifi: state: init -&gt; auth (b0)
I (1552) wifi: state: auth -&gt; assoc (0)
I (1562) wifi: state: assoc -&gt; run (10)
I (1582) wifi: connected with myssid, channel 1
I (1582) wifi: pm start, type: 1
I (1582) NETWORK: SYSTEM_EVENT_STA_CONNECTED received.
I (2212) event: sta ip: 192.168.1.236, mask: 255.255.255.0, gw: 192.168.1.1
I (2212) NETWORK: SYSTEM_EVENT_STA_GOT_IP: 192.168.1.236
Acquired IP address: &quot;192.168.1.236&quot; Netmask: &quot;255.255.255.0&quot; Gateway: &quot;192.168.1.1&quot;
Opened UDP socket on &quot;0.0.0.0:44404&quot;.
Waiting to receive data...
</pre></div>
</div>
<p>You can send UDP packets to the AtomVM instance using <code class="docutils literal notranslate"><span class="pre">netcat</span></code> (or <code class="docutils literal notranslate"><span class="pre">nc</span></code> on some platforms), in a separate terminal window:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ nc -u 192.168.1.236 44404
</pre></div>
</div>
<p>Every time you enter a line of text, the blue LED on the ESP32 SoC (pin 2) should toggle on and off, and you should see output on the console, such as</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Received UDP packet &lt;&lt;100,115,102,115,100,10&gt;&gt; from &quot;192.168.1.237:53291&quot;
Waiting to receive data...
</pre></div>
</div>
</section>
<section id="tcp-server-blink">
<h3><code class="docutils literal notranslate"><span class="pre">tcp_server_blink</span></code><a class="headerlink" href="#tcp-server-blink" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">tcp_server_blink</span></code> example will connect to your local WiFi network and obtain and IP address.  It will then start a TCP server on port 44404.  When a TCP message is received, the blue LED on the ESP32 SoC (pin 2) will toggle on and off.</p>
<blockquote>
<div><p>Note.  AtomVM currently only supports station mode (STA).</p>
</div></blockquote>
<blockquote>
<div><p>Note.  AtomVM currently only supports IPv4 addresses.</p>
</div></blockquote>
<blockquote>
<div><p>Note.  You will need to edit the <code class="docutils literal notranslate"><span class="pre">examples/erlang/esp32/tcp_server_blink.erl</span></code> source file and set the <code class="docutils literal notranslate"><span class="pre">ssid</span></code> and <code class="docutils literal notranslate"><span class="pre">psk</span></code> parameters to match your local WiFi network, and then rebuild the example.</p>
</div></blockquote>
<p>Flash the example program to your device as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ ./tools/dev/flash.sh build/examples/erlang/esp32/tcp_server_blink.avm
...
Hard resetting via RTS pin...
</pre></div>
</div>
<p>You should see the following output when monitoring the ESP32 output (truncated for brevity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ make monitor
Found AVM partition: size: 1048576, address: 0x110000
Booting file mapped at: 0x3f420000, size: 1048576
Starting: tcp_server_blink.beam...
---
start
I (296) wifi: wifi driver task: 3ffc650c, prio:23, stack:3584, core=0
I (296) wifi: wifi firmware version: 9415913
I (296) wifi: config NVS flash: enabled
I (296) wifi: config nano formatting: disabled
I (296) system_api: Base MAC address is not set, read default base MAC address from BLK0 of EFUSE
I (306) system_api: Base MAC address is not set, read default base MAC address from BLK0 of EFUSE
I (346) wifi: Init dynamic tx buffer num: 32
I (346) wifi: Init data frame dynamic rx buffer num: 32
I (346) wifi: Init management frame dynamic rx buffer num: 32
I (346) wifi: Init static rx buffer size: 1600
I (356) wifi: Init static rx buffer num: 10
I (356) wifi: Init dynamic rx buffer num: 32
I (366) NETWORK: starting wifi: SSID: [myssid], password: [XXXXXXXX].
I (446) phy: phy_version: 4008, c9ae59f, Jan 25 2019, 16:54:06, 0, 0
I (446) wifi: mode : sta (3c:71:bf:84:d9:08)
I (446) NETWORK: SYSTEM_EVENT_STA_START received.
I (1176) wifi: n:6 0, o:1 0, ap:255 255, sta:6 0, prof:1
I (2156) wifi: state: init -&gt; auth (b0)
I (2166) wifi: state: auth -&gt; assoc (0)
I (2166) wifi: state: assoc -&gt; run (10)
I (2196) wifi: connected with myssid, channel 6
I (2196) wifi: pm start, type: 1
I (2196) NETWORK: SYSTEM_EVENT_STA_CONNECTED received.
I (2746) event: sta ip: 192.168.1.236, mask: 255.255.255.0, gw: 192.168.1.1
I (2746) NETWORK: SYSTEM_EVENT_STA_GOT_IP: 192.168.1.236
Acquired IP address: &quot;192.168.1.236&quot; Netmask: &quot;255.255.255.0&quot; Gateway: &quot;192.168.1.1&quot;
Listening on &quot;0.0.0.0:44404&quot;.
Waiting to accept connection...
</pre></div>
</div>
<p>You can send TCP packets to the AtomVM instance using <code class="docutils literal notranslate"><span class="pre">netcat</span></code> (or <code class="docutils literal notranslate"><span class="pre">nc</span></code> on some platforms), in a separate terminal window, e.g.,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>shell$ nc 192.168.1.236 44404
</pre></div>
</div>
<p>On the ESP32 console, you should see:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Accepted connection.  local: &quot;192.168.1.236:44404&quot; peer: &quot;192.168.1.237:55275&quot;
Waiting to receive data...
Waiting to accept connection...
</pre></div>
</div>
<p>Every time you enter a line of text, the blue LED on the ESP32 SoC (pin 2) should toggle on and off, and the data you entered should get echoed back to the <code class="docutils literal notranslate"><span class="pre">netcat</span></code> console.</p>
<p>On the ESP32 console, you should see:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Received packet [115,100,102,115,100,102,10] from &quot;192.168.1.237:55275&quot;.  Echoing back...
Waiting to receive data...
</pre></div>
</div>
<p>every time a packet is sent to the server.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="programmers-guide.html" class="btn btn-neutral float-left" title="Programmers Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="network-programming-guide.html" class="btn btn-neutral float-right" title="Network Programming Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2022, AtomVM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>